"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2490],{2490:($,b,l)=>{l.r(b),l.d(b,{DetailGenericDocumentPageModule:()=>H});var w=l(6814),v=l(95),r=l(878),y=l(9481),D=l(5861),t=l(6689),U=l(5472),S=l(7398),T=l(553),A=l(7114),P=l(9599),Z=l(9862),I=l(8639);let k=(()=>{var i;class c{constructor(a){this.http=a,this.appUrl=T.N.apiUrl}enviarDocumentoYFecha(a,e,s){var o=this;return(0,D.Z)(function*(){try{return yield o.http.post(o.appUrl+"api/update-document/"+e+"/"+s,a).toPromise()}catch(u){throw u}})()}}return(i=c).\u0275fac=function(a){return new(a||i)(t.LFG(Z.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),c})();var F=l(9894);function K(i,c){if(1&i&&t._UZ(0,"img",10),2&i){const n=t.oxw(2);t.Q6J("src",n.appUrl+n.detail.details.state.documentPaths,t.LSH)}}function J(i,c){1&i&&t._UZ(0,"ion-img",11)}function N(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"ion-checkbox",12),t.NdJ("ionChange",function(e){t.CHM(n);const s=t.oxw(2);return t.KtG(s.onCheckChange(e,s.detail.details.state.buttonIds))}),t.qZA()}if(2&i){const n=t.oxw(2);t.Q6J("checked",1===n.detail.details.state.status)}}function Y(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",13),t._uU(2),t.qZA(),t.TgZ(3,"ion-textarea",14),t.NdJ("ionChange",function(e){t.CHM(n);const s=t.oxw(2);return t.KtG(s.onCommentChange(e))})("ngModelChange",function(e){t.CHM(n);const s=t.oxw(2);return t.KtG(s.detail.details.state.comment=e)}),t.qZA()()}if(2&i){const n=t.oxw(2);t.xp6(2),t.hij("",n.translationService.getTranslation("comments")," "),t.xp6(1),t.Q6J("ngModel",n.detail.details.state.comment)}}function O(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"ion-grid"),t._UZ(1,"ion-row"),t.TgZ(2,"ion-row")(3,"ion-col",5),t.YNc(4,K,1,1,"img",6),t.YNc(5,J,1,0,"ion-img",7),t.qZA()(),t.TgZ(6,"ion-row")(7,"ion-col",5)(8,"ion-item")(9,"ion-label"),t._uU(10),t.qZA(),t.YNc(11,N,1,1,"ion-checkbox",8),t.qZA()()(),t.TgZ(12,"ion-row")(13,"ion-col",5),t.YNc(14,Y,4,2,"ion-item",3),t.qZA()(),t.TgZ(15,"ion-row")(16,"ion-col",5)(17,"ion-button",9),t.NdJ("click",function(){t.CHM(n);const e=t.oxw();return t.KtG(e.enviarDatos(e.detail.details.state.buttonIds))}),t._uU(18),t.qZA()()()()}if(2&i){const n=t.oxw();t.xp6(4),t.Q6J("ngIf",!n.isPdf(n.detail.details.state.documentPaths)),t.xp6(1),t.Q6J("ngIf",n.isPdf(n.detail.details.state.documentPaths)),t.xp6(5),t.Oqu(n.translationService.getTranslation(n.hasComment?"deny":"approve")),t.xp6(1),t.Q6J("ngIf",!n.hasComment),t.xp6(3),t.Q6J("ngIf",!n.hasCheck),t.xp6(4),t.Oqu(n.hasComment?"Rechazar":"Guardar")}}function Q(i,c){if(1&i&&t._UZ(0,"ion-img",23),2&i){const n=t.oxw(3);t.Q6J("src",n.selectedFileDataUrl)}}function z(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"ion-row")(1,"ion-col",5)(2,"ion-label",17),t._uU(3),t.qZA(),t.TgZ(4,"ion-button",18),t.NdJ("click",function(){t.CHM(n);const e=t.oxw(2);return t.KtG(e.onSubmit(e.detail.details.state.buttonIds,e.detail.details.state.models,e.detail.details.state.ids))}),t._UZ(5,"ion-icon",19),t.TgZ(6,"ion-label"),t._uU(7),t.qZA(),t._UZ(8,"input",20,21),t.qZA(),t.YNc(10,Q,1,1,"ion-img",22),t.qZA()()}if(2&i){const n=t.oxw(2);t.xp6(3),t.hij("\xa0\xa0\xa0\xa0",n.translationService.getTranslation("uploadDocument"),""),t.xp6(4),t.hij("\xa0",n.translationService.getTranslation("select")," "),t.xp6(3),t.Q6J("ngIf",n.selectedFileDataUrl)}}function q(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col",5)(3,"ion-item")(4,"ion-label",15),t._uU(5),t.qZA(),t.TgZ(6,"ion-datetime",16),t.NdJ("ngModelChange",function(e){t.CHM(n);const s=t.oxw();return t.KtG(s.expirationDate=e)}),t.qZA()()()(),t.YNc(7,z,11,3,"ion-row",3),t.qZA()}if(2&i){const n=t.oxw();t.xp6(5),t.Oqu(n.translationService.getTranslation("expirate")),t.xp6(1),t.Q6J("ngModel",n.expirationDate)("min",n.minDate)("max",n.maxYear),t.xp6(1),t.Q6J("ngIf",n.expirationDate)}}function E(i,c){if(1&i){const n=t.EpF();t.TgZ(0,"ion-fab",24)(1,"ion-fab-button"),t._UZ(2,"ion-icon",25),t.qZA(),t.TgZ(3,"ion-fab-list",26)(4,"ion-fab-button")(5,"ion-icon",27),t.NdJ("click",function(){t.CHM(n);const e=t.oxw();return t.KtG(e.shareImage(e.appUrl+e.detail.details.state.documentPaths+"#"))}),t.qZA()(),t.TgZ(6,"ion-fab-button")(7,"ion-icon",28),t.NdJ("click",function(){t.CHM(n);const e=t.oxw();return t.KtG(e.convertNull())}),t.qZA()()()()}2&i&&t.Q6J("edge",!0)}const j=[{path:"",component:(()=>{var i;class c{constructor(a,e,s,o,u,m,_,g,f){var d;this.route=a,this.router=e,this.loadingController=s,this.http=o,this.modalCtrl=u,this.sharedCheckService=m,this.apiService=_,this.toastController=g,this.translationService=f,this.appUrl=T.N.apiUrl,this.selectedFileDataUrl=null,this.expirationDate=null,this.minDate=(new Date).toISOString(),this.maxYear=((new Date).getFullYear()+15).toString(),this.platform=(0,t.f3M)(U.t4),this.detail=null===(d=this.router.getCurrentNavigation())||void 0===d?void 0:d.extras.state}ngOnInit(){this.currentState$=this.route.paramMap.pipe((0,S.U)(()=>window.history.state.details.queryParams)),1===this.detail.details.state.status?(this.hasCheck=!0,this.statusChange=1):2===this.detail.details.state.status&&(this.statusChange=2)}onFileSelected(a){var e=this;return(0,D.Z)(function*(){const s=a.target.files[0];if(e.fileUpload=s,s)if(s.type.startsWith("image/")){const o=new FileReader;o.onload=u=>{e.selectedFileDataUrl=o.result},o.readAsDataURL(s)}else"application/pdf"===s.type||((yield e.toastController.create({message:"Formato de archivo no compatible!",duration:3e3,cssClass:"custom-toast"})).present(),console.error("Formato de archivo no compatible:",s.type))})()}onSubmit(a,e,s){var o=this;return(0,D.Z)(function*(){try{o.loading=yield o.loadingController.create({cssClass:"custom-spinner",spinner:null,translucent:!0,backdropDismiss:!1}),yield o.loading.present();const u=yield P.V1.getPhoto({quality:90,allowEditing:!0,resultType:P.dk.DataUrl,source:P.oK.Prompt});if(!o.expirationDate||!u.dataUrl){const R=yield o.toastController.create({message:"Por favor seleccione una fecha y tome una foto!",duration:3e3,cssClass:"custom-toast"});return o.loading.dismiss(),void R.present()}const m=new FormData,g={Airworthiness_Certificate:"airworthiness_card",Registration:"certificate_tail",Mexican_insurance:"mexican_insurance",WorldWide_insurance:"worldwide_insurance",Air_carrier_certificate:"air_carrier_certificate",Tail_number_listing:"tail_number_listing",Entry_permit:"entry_permit",Piu:"piu"}[a]||a.toLowerCase().replace(" ","_"),f=new Date(o.expirationDate),d=f.getFullYear(),h=(f.getMonth()+1).toString().padStart(2,"0"),p=f.getDate().toString().padStart(2,"0");m.append("date_"+g,`${d}-${h}-${p}`),m.append(g,o.dataURItoBlob(u.dataUrl),"file.jpg"),m.append("method","_PUT"),m.append("fileName","archivo.jpg");const C=yield o.apiService.enviarDocumentoYFecha(m,e,s);o.loading.dismiss(),(yield o.toastController.create({message:"Archivo subido exitosamente!",duration:3e3,cssClass:"custom-toast"})).present();const M=C[g][g];o.sharedCheckService.setImageChange(M,g),o.detail.details.state.documentPaths=M}catch(u){o.loading.dismiss(),console.error("Error al enviar el documento y la fecha de expiraci\xf3n:",u)}})()}dataURItoBlob(a){const e=atob(a.split(",")[1]),s=a.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),u=new Uint8Array(o);for(let m=0;m<e.length;m++)u[m]=e.charCodeAt(m);return new Blob([o],{type:s})}isPdf(a){return!!a&&a.endsWith(".pdf")}shareImage(a){return(0,D.Z)(function*(){try{yield A.m.share({url:a})}catch(e){console.error("Error al compartir:",e)}})()}convertNull(){this.detail.details.state.documentPaths=null}getBackButtonText(){return this.platform.is("ios")?"Ope":""}enviarDocumento(){throw new Error("Method not implemented.")}onCommentChange(a){this.hasComment=""!==a.target.value.trim()}onCheckChange(a,e){this.hasCheck=a.detail.checked,this.statusChange=a.detail.checked?1:2}enviarDatos(a){var e=this;return(0,D.Z)(function*(){e.loading=yield e.loadingController.create({cssClass:"custom-spinner",spinner:null,translucent:!0,backdropDismiss:!1}),yield e.loading.present();let o,s=new FormData;const _={fuel_release:{id:e.detail.details.state.ids,statusKey:"fuel_release_status",commentsKey:"fuel_release_comments",model:"ope",path:""},piu:{id:e.detail.details.state.ids,statusKey:"piu_status",commentsKey:"piu_comments",model:"ope",path:""},charter_permission_mxn:{id:e.detail.details.state.ids,statusKey:"charter_permission_mxn_status",commentsKey:"charter_permission_mxn_comments",model:"ope",path:""},diplomatic_card:{id:e.detail.details.state.ids,statusKey:"diplomatic_card_status",commentsKey:"diplomatic_card_comments",model:"ope",path:""},airworthiness_card:{id:e.detail.details.state.ids,statusKey:"airworthiness_card_status",commentsKey:"airworthiness_card_comments",model:"air",path:"aircraft.0"},mexican_insurance:{id:e.detail.details.state.ids,statusKey:"mexican_insurance_status",commentsKey:"mexican_insurance_comments",model:"air",path:"aircraft.0"},certificate_tail:{id:e.detail.details.state.ids,statusKey:"certificate_tail_status",commentsKey:"certificate_tail_comments",model:"air",path:"aircraft.0"},worldwide_insurance:{id:e.detail.details.state.ids,statusKey:"worldwide_insurance_status",commentsKey:"worldwide_insurance_comments",model:"air",path:"aircraft.0"},entry_permit:{id:e.detail.details.state.ids,statusKey:"entry_permit_status",commentsKey:"entry_permit_comments",model:"air",path:"aircraft.0"}}[a],g=(d,h,p)=>{null!=p?d.append(h,p.toString()):console.warn(`El valor para la clave '${h}' es ${p}, que es null o undefined.`)};_&&(o=_.model||"ope",g(s,_.statusKey,e.statusChange),g(s,_.commentsKey,e.detail.details.state.comment),s.append("method","_PUT")),e.http.post(e.appUrl+"api/update-document/"+o+"/"+_.id,s).subscribe(d=>{e.modalCtrl.dismiss(),e.loading.dismiss();const x=Object.keys(d[a]).find(C=>C.endsWith("_status"));if(void 0!==x){const G=parseInt(d[a][x],10);e.sharedCheckService.setStatusChange(G,a)}},d=>{console.error("Error al realizar la solicitud HTTP",d),e.loading.dismiss()})})()}}return(i=c).\u0275fac=function(a){return new(a||i)(t.Y36(y.gz),t.Y36(y.F0),t.Y36(r.HT),t.Y36(Z.eN),t.Y36(r.IN),t.Y36(I.A),t.Y36(k),t.Y36(r.yF),t.Y36(F.D))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-detail-generic-document"]],decls:10,vars:6,consts:[[3,"translucent"],["slot","start"],["defaultHref","/",3,"text"],[4,"ngIf"],["slot","fixed","vertical","top","horizontal","end",3,"edge",4,"ngIf"],["size","12"],["class","img","alt","Documento",3,"src",4,"ngIf"],["src","../../assets/pdf.jpg","name","cloud-download-outline","class","large-icon",4,"ngIf"],[3,"checked","ionChange",4,"ngIf"],["expand","full",3,"click"],["alt","Documento",1,"img",3,"src"],["src","../../assets/pdf.jpg","name","cloud-download-outline",1,"large-icon"],[3,"checked","ionChange"],["position","stacked"],[3,"ngModel","ionChange","ngModelChange"],["position","stacked",1,"expiration-label"],["presentation","month-year",1,"expiration-date",3,"ngModel","min","max","ngModelChange"],[1,"file-label"],["expand","full","fill","outline",1,"file-button",3,"click"],["name","cloud-upload-outline"],["accept",".pdf, image/*",1,"file-input"],["fileInput",""],[3,"src",4,"ngIf"],[3,"src"],["slot","fixed","vertical","top","horizontal","end",3,"edge"],["name","chevron-down-circle"],["side","bottom"],["name","share-outline",3,"click"],["name","create-outline",3,"click"]],template:function(a,e){1&a&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.qZA()()(),t.TgZ(6,"ion-content"),t.YNc(7,O,19,6,"ion-grid",3),t.YNc(8,q,8,5,"ion-grid",3),t.YNc(9,E,8,1,"ion-fab",4),t.qZA()),2&a&&(t.Q6J("translucent",!0),t.xp6(3),t.Q6J("text",e.getBackButtonText()),t.xp6(2),t.Oqu(e.detail.details.state.labels),t.xp6(2),t.Q6J("ngIf",e.detail.details.state.documentPaths),t.xp6(1),t.Q6J("ngIf",!e.detail.details.state.documentPaths),t.xp6(1),t.Q6J("ngIf",e.detail.details.state.documentPaths))},dependencies:[w.O5,v.JJ,v.On,r.YG,r.Sm,r.nz,r.wI,r.W2,r.x4,r.IJ,r.W4,r.zq,r.jY,r.Gu,r.gu,r.Xz,r.Ie,r.Q$,r.Nd,r.g2,r.wd,r.sr,r.w,r.QI,r.j9,r.oU],styles:['@charset "UTF-8";.img[_ngcontent-%COMP%]{margin-left:1%;margin-right:2%;height:400px;width:800px}.floating-button-container[_ngcontent-%COMP%]{position:absolute;top:5;right:-80%;z-index:100;width:50%}.file-label[_ngcontent-%COMP%]{font-size:16px;font-weight:700;margin-bottom:10px}.file-button[_ngcontent-%COMP%]{margin-bottom:10px}.file-input[_ngcontent-%COMP%]{display:none}.expiration-label[_ngcontent-%COMP%]{font-size:16px;font-weight:700}.expiration-date[_ngcontent-%COMP%]{font-size:14px}.send-button[_ngcontent-%COMP%]{margin-top:20px;--color: #fff;--border-radius: 5px}ion-toast.custom-toast[_ngcontent-%COMP%]{--background: #f4f4fa;--box-shadow: 3px 3px 10px 0 rgba(0, 0, 0, .2);--color: #4b4a50}ion-toast.custom-toast[_ngcontent-%COMP%]::part(message){font-style:italic}ion-toast.custom-toast[_ngcontent-%COMP%]::part(button){border-left:1px solid #d2d2d2;color:#030207;font-size:15px}']}),c})()}];let B=(()=>{var i;class c{}return(i=c).\u0275fac=function(a){return new(a||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[y.Bz.forChild(j),y.Bz]}),c})(),H=(()=>{var i;class c{}return(i=c).\u0275fac=function(a){return new(a||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[w.ez,v.u5,r.Pc,B]}),c})()}}]);